# minarch-cores Recipe: arm64
# Architecture: ARMv8-A+CRC with NEON (64-bit)
# Target Devices: Anbernic RG28xx/35xx/40xx, Trimui, CubeXX
#
# This file contains both CPU configuration and core definitions.
---
config:
  # Architecture settings
  arch: aarch64
  target_cross: aarch64-linux-gnu-
  gnu_target_name: aarch64-buildroot-linux-gnu

  # CPU-specific optimization flags
  target_cpu: cortex-a53
  target_arch: armv8-a+crc
  target_optimization: "-march=armv8-a+crc -mcpu=cortex-a53 -mtune=cortex-a53"
  target_float: ""

  # Compiler flags (aggressive optimization as backstop for platform flags)
  # Note: -ffast-math avoided as supafaust rejects __FAST_MATH__; -fno-math-errno gives similar benefit
  # Platform-specific Makefiles add -Ofast/-ffast-math where appropriate
  target_cflags: "-O3 -fno-math-errno -flto -fdata-sections -ffunction-sections -fomit-frame-pointer -pipe -fsigned-char"
  target_cxxflags: "-O3 -fno-math-errno -flto -fdata-sections -ffunction-sections -fomit-frame-pointer -pipe -fsigned-char"
  target_ldflags: "-flto -Wl,--gc-sections"

  # Buildroot-style variables
  buildroot:
    BR2_aarch64: y
    BR2_cortex_a53: y
    BR2_ARM_FPU_NEON_FP_ARMV8: y
    BR2_TOOLCHAIN_USES_GLIBC: y

# Core definitions
cores:
  atari800:
    repo: libretro/libretro-atari800
    target: master
    commit: 630f2346a1dabefdcf534880a48e3e200e2cc551
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: atari800_libretro.so

  beetle-lynx:
    repo: libretro/beetle-lynx-libretro
    target: master
    commit: efd1797c7aa5a83c354507b1b61ac24222ebaa58
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: mednafen_lynx_libretro.so
    extra_args:
      - NEED_BPP=16

  beetle-pce-fast:
    repo: libretro/beetle-pce-fast-libretro
    target: master
    commit: 7e9b257b8a591cb7e00f9e55371edba19db9799c
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: mednafen_pce_fast_libretro.so
    extra_args:
      - NEED_BPP=16

  beetle-supergrafx:
    repo: libretro/beetle-supergrafx-libretro
    target: master
    commit: a776133c34ae8da5daf7d9ccb43e3e292e2b07b0
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: mednafen_supergrafx_libretro.so

  beetle-vb:
    repo: libretro/beetle-vb-libretro
    target: master
    commit: 8f837ebc077afdd6652efb2827fd8308a07113ca
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: mednafen_vb_libretro.so
    extra_args:
      - NEED_BPP=16

  beetle-wswan:
    repo: libretro/beetle-wswan-libretro
    target: master
    commit: 2aeb47d3a58bf0360c686f842d9bb5bd201306fe
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: mednafen_wswan_libretro.so

  fake08:
    repo: jtothebell/fake-08
    target: master
    commit: 0d26fd59103941e5f95e0ee665c6e0fb8c6b6f03
    build_type: make
    makefile: Makefile
    build_dir: platform/libretro
    platform: unix
    so_file: platform/libretro/fake08_libretro.so
    submodules: true

  fbneo:
    repo: libretro/FBNeo
    target: master
    commit: d94677cd17c7315006e54b3d64774a26db200bcd
    build_type: make
    makefile: Makefile
    build_dir: src/burner/libretro
    platform: unix
    so_file: src/burner/libretro/fbneo_libretro.so

  fceumm:
    repo: libretro/libretro-fceumm
    target: master
    commit: 5cd4a43e16a7f3cd35628d481c347a0a98cfdfa2
    build_type: make
    makefile: Makefile.libretro
    build_dir: "."
    platform: unix
    so_file: fceumm_libretro.so
    extra_args:
      - HAVE_NTSC=0
      - WANT_32BPP=0

  flycast:
    repo: flyinghead/flycast
    target: v2.0
    commit: aa97a6d64fb47d3ce0febaa575b26d975dd916e4
    build_type: cmake
    so_file: build/flycast_libretro.so
    submodules: true
    cmake_opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DLIBRETRO=ON
      - -DUSE_OPENMP=ON
      - -DUSE_GLES=ON

  gambatte:
    repo: libretro/gambatte-libretro
    target: master
    commit: 6924c76ba03dadddc6e97fa3660f3d3bc08faa94
    build_type: make
    makefile: Makefile.libretro
    build_dir: "."
    platform: unix
    so_file: gambatte_libretro.so
    extra_args:
      - PLATFORM_DEFINES=-DCC_RESAMPLER -DCC_RESAMPLER_NO_HIGHPASS

  gpsp:
    repo: libretro/gpsp
    target: master
    commit: 6250979f01db3f9ee5ebca179316e1319f017b48
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: arm64
    so_file: gpsp_libretro.so

  gw:
    repo: libretro/gw-libretro
    target: master
    commit: 435e5cfd4bf6aea03a84259e9b8dba3daf3ff5bd
    build_type: make
    makefile: Makefile.libretro
    build_dir: "."
    platform: unix
    so_file: gw_libretro.so

  melonds:
    repo: libretro/melonds
    target: master
    commit: 7a3c11ff970cd36ca806961fae6db94b30dd5401
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: melonds_libretro.so

  mgba:
    repo: libretro/mgba
    target: master
    commit: c758314a639aa0066e7b65a8341448181b73c804
    build_type: make
    makefile: Makefile.libretro
    build_dir: "."
    platform: unix
    so_file: mgba_libretro.so

  mame2003-plus:
    repo: libretro/mame2003-plus-libretro
    target: master
    commit: 26cc26baf1357a581581ea5b3b6978391373d0a8
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: mame2003_plus_libretro.so

  mupen64plus-next:
    repo: libretro/mupen64plus-libretro-nx
    target: develop
    commit: 680e033fc8ed1a49df7b156d97164e0050ee13bc
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: mupen64plus_next_libretro.so

  neocd:
    repo: libretro/neocd_libretro
    target: master
    commit: 5eca2c8fd567b5261251c65ecafa8cf5b179d1d2
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: neocd_libretro.so

  pcsx:
    repo: libretro/pcsx_rearmed
    target: master
    commit: 9059485691c44cb3a555464b06eddfb1082d586c
    build_type: make
    makefile: Makefile.libretro
    build_dir: "."
    platform: unix
    so_file: pcsx_rearmed_libretro.so

  picodrive:
    repo: libretro/picodrive
    target: master
    commit: 3365b1774bc8680be9899968fe45b224ad2f11c1
    build_type: make
    makefile: Makefile.libretro
    build_dir: "."
    platform: unix
    so_file: picodrive_libretro.so
    submodules: true

  pokemini:
    repo: libretro/PokeMini
    target: master
    commit: 19095803f1434eb980db6e4004187a4b786e20b6
    build_type: make
    makefile: Makefile.libretro
    build_dir: "."
    platform: unix
    so_file: pokemini_libretro.so

  ppsspp:
    repo: hrydgard/ppsspp
    target: v1.18.1
    commit: 98a8583b1783af766423ec799e82d5829a7f496d
    build_type: cmake
    so_file: build/lib/ppsspp_libretro.so
    submodules: true
    prebuild_script: build-ppsspp-ffmpeg.sh
    cmake_opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=OFF
      - -DCMAKE_SYSTEM_NAME=Linux
      - -DLIBRETRO=ON
      - -DARM64=ON
      - -DANDROID=OFF
      - -DWIN32=OFF
      - -DAPPLE=OFF
      - -DUSE_DISCORD=OFF
      - -DUSING_FBDEV=OFF
      - -DUNITTEST=OFF
      - -DSIMULATOR=OFF
      - -DENABLE_CTEST=OFF
      - -DVULKAN=OFF
      - -DUSE_WAYLAND_WSI=OFF
      - -DUSING_X11_VULKAN=OFF
      - -DCMAKE_C_FLAGS=-DEGL_NO_X11=1 -DMESA_EGL_NO_X11_HEADERS=1
      - -DCMAKE_CXX_FLAGS=-DEGL_NO_X11=1 -DMESA_EGL_NO_X11_HEADERS=1
      - -DUSE_FFMPEG=ON
      - -DUSE_SYSTEM_FFMPEG=OFF

  prosystem:
    repo: libretro/prosystem-libretro
    target: master
    commit: acae250da8d98b8b9707cd499e2a0bf6d8500652
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: prosystem_libretro.so

  race:
    repo: libretro/RACE
    target: master
    commit: 171950ea64c96ead503340ed60fa7ba18f56325c
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: race_libretro.so

  snes9x2005:
    repo: libretro/snes9x2005
    target: master
    commit: 74d871db9b4dba6dbe6c5ecebc88cbf255be5349
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: snes9x2005_plus_libretro.so
    extra_args:
      - USE_BLARGG_APU=1

  stella:
    repo: libretro/stella2014-libretro
    target: master
    commit: 3cc89f0d316d6c924a5e3f4011d17421df58e615
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: stella2014_libretro.so

  supafaust:
    repo: libretro/supafaust
    target: master
    commit: e25f66765938d33f9ad5850e8d6cd597e55b7299
    build_type: make
    makefile: Makefile
    build_dir: "."
    platform: unix
    so_file: mednafen_supafaust_libretro.so

  vecx:
    repo: libretro/libretro-vecx
    target: master
    commit: 841229a6a81a0461d08af6488f252dcec5266c6a
    build_type: make
    makefile: Makefile.libretro
    build_dir: "."
    platform: unix
    so_file: vecx_libretro.so
    extra_args:
      - HAS_GPU=0

